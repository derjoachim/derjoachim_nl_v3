<!DOCTYPE html>
<html lang="en-US">
	<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,700italic,700,300' rel='stylesheet' type='text/css'>

	<title>Split Views using Nooku Framework</title>
	<meta name="description" content="      Split View showing the boats list in Harbour, our example component  ">

	<link rel="stylesheet" href="/css/main.css">
	<link rel="canonical" href="http://derjoachim.nl/blog/2010/12/split-views-using-nooku-framework/">
	<link rel="alternate" type="application/rss+xml" title="Der Joachim" href="http://derjoachim.nl/feed.xml" />
	<script type="text/javascript">
		/*
		var _gaq = _gaq || [];
 	 	 _gaq.push(['_setAccount', 'UA-22946638-1']);
			_gaq.push(['_trackPageview']);

			(function() {
				var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
				ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
			})();
			*/
	</script>
</head>

	<body>
		<header class="site-header">
  <div class="wrapper">
    <a class="site-title" href="/">Der Joachim</a>
    <nav class="site-nav">
      <div class="trigger">
          
          <a class="page-link" href="/blog/2010/12/split-views-using-nooku-framework/">Split Views using Nooku Framework</a>
          
      </div>
    </nav>
  </div>
</header>

		<div class="post">

  <header class="post-header">
    <h1 class="post-title">Split Views using Nooku Framework</h1>
    <p class="post-meta">Dec 28, 2010 • Stian</p>
  </header>

  <article class="post-content">
    <div class="wp-caption alignnone" style="width: 490px">
  <a title="Harbour with SplitView by Nooku, on Flickr" href="http://www.flickr.com/photos/nooku/5285180568/"><img src="http://farm6.static.flickr.com/5124/5285180568_5c74163287.jpg" alt="Harbour with SplitView" width="480" /></a><p class="wp-caption-text">
    Split View showing the boats list in Harbour, our example component
  </p>
</div>


<p>A month ago Martin asked a very interesting <a href="http://twitter.com/#!/mblodau/status/6990026000826368">question on Twitter</a>.</p>

<blockquote><p>Possible to load a detail view &amp; it&#8217;s related list view besides each other in the tab of a third view with the &#8220;H&#8221; of HMVC?</p></blockquote>

<p>Short answer, <a href="http://twitter.com/#!/nooku/status/7011271765397504">yes offcourse !</a> Luckily our blog doesn’t have a 140 char limit so I can also show you how. In this tutorial I will explain:</p>

<ol>
<li>How to create a Ajaxed Split View.</li>
<li>How to render that Split View from a module.</li>
</ol>


<p>We will use the overlays <a href="http://blog.nooku.org/2010/12/ajax-widgets-with-nooku-framework/">we learned about in my previous blog post</a>, and apply this to create the Split View.</p>

<!--more-->


<h3>What’s a Split View?</h3>

<p>Split Views are a common <a href="http://developer.apple.com/library/safari/documentation/UserExperience/Conceptual/MobileHIG/UIElementGuidelines/UIElementGuidelines.html#//apple_ref/doc/uid/TP40006556-CH13-SW51">UI pattern</a> that involves subviews that relate to one another. Usually that means a list to the left that loads data into the right hand view when you select an item.</p>

<p>The code used in this tutorial is from the Split View implementation in <a href="http://www.assembla.com/wiki/show/nooku-examples/com_harbour">Harbour</a>, describing how I did it and how you can accomplish it in your own extension.</p>

<h3>Step 1 &#8211; HTML and CSS</h3>

<p>There are many different Split View layouts, the kind we’ll be making is usually called “split” as it’s a 25/75 layout with a list to the left and details to the right.</p>

<h4>Boats view</h4>

<p>So we’ll create a new layout in our plural view here:<br/>
<a href="https://nooku.assembla.com/code/nooku-examples/subversion/nodes/trunk/harbour/code/site/components/com_harbour/views/boats/tmpl/split.php">/com_harbour/views/boats/tmpl/split.php</a></p>

<p>In this layout we essentially need to load our assets, create an unordered list of links and have a <code>&lt;div&gt;</code> container as a placeholder for the details view.</p>

<pre name="code" class="php:nocontrols">&lt;ul class="mod-harbour-boats"&gt;
    &lt;? foreach ($boats as $boat) : ?&gt;
    &lt;li&gt;
        &lt;a title="&lt;?= @escape($boat-&gt;title) ?&gt;" href="&lt;?= @route('view=boat&layout=split&slug='.@escape($boat-&gt;slug)); ?&gt;#boat-overlay"&gt;
            &lt;img alt="" src="media://com_harbour/images/flags/&lt;?= @escape($boat-&gt;flag);?&gt;" /&gt;
            &lt;?= @escape($boat-&gt;title) ?&gt;
        &lt;/a&gt;
    &lt;/li&gt;
    &lt;? endforeach; ?&gt;
&lt;/ul&gt;
&lt;div id="boat-overlay"&gt;
    &lt;?= KFactory::tmp('site::com.harbour.controller.boat')-&gt;read() ?&gt;
&lt;/div&gt;</pre>


<h4>Boat view, details of a boat</h4>

<p>Next we need the boat view, which will contain the details of a boat and will be loaded when you click on a link in the unordered list of links we just created. <a href="https://nooku.assembla.com/code/nooku-examples/subversion/nodes/trunk/harbour/code/site/components/com_harbour/views/boat/tmpl/split.php">/com_harbour/views/boat/tmpl/split.php</a></p>

<pre name="code" class="php:nocontrols">&lt;div id="boat-overlay"&gt;
    &lt;?= @template('simple') ?&gt;
&lt;/div&gt;</pre>


<p>As you can see it’s just a div wrap around the <strong>“simple”</strong> layout, with the id <strong>“boat-overlay”</strong>.</p>

<p>It’s important to note that each link got a <strong>#boat-overlay</strong> hash. KOverlay use that to know what part of the html in the Ajax response that you want in your details view. For more details on how this works see <a href="http://blog.nooku.org/2010/12/ajax-widgets-with-nooku-framework/">my previous post</a>.</p>

<p>That’s why our second layout got a div wrapper with a matching id.</p>

<h4>Let&#8217;s make it look good</h4>

<p>To make it look more like a real Split View, create a CSS file here:<br/>
<a href="https://nooku.assembla.com/code/nooku-examples/subversion/nodes/trunk/harbour/code/media/com_harbour/css/split.css">/media/com_harbour/css/split.css</a></p>

<pre name="code" class="css:nocontrols">.mod-harbour-boats, #boat-overlay {
    float: left;
    height: 400px;
    margin: 0;
}
.mod-harbour-boats {
    width: 25%;
}
#boat-overlay {
    width: 75%;
    overflow: hidden;
}
#boat-overlay #boat {
    float: none;
}
.mod-harbour-boats {
    padding: 0;
    overflow-x: hidden;
}
.mod-harbour-boats li {
    background: none;
    display: block;
    text-overflow: ellipsis;
    overflow: hidden;
    white-space: nowrap;
}
.mod-harbour-boats li a {
    display: block;
    height: 32px;
    font-size: 12px;
    font-weight: bold;
    line-height: 32px;
    text-indent: 15px;
}
</pre>


<h3>Step 2 &#8211; KOverlay and a little bit of MooTools</h3>

<p>Start off by creating the following js file:<br/>
<a href="https://nooku.assembla.com/code/nooku-examples/subversion/nodes/trunk/harbour/code/media/com_harbour/js/split.js"> /media/com_harbour/js/split.js</a></p>

<pre name="code" class="js:nocontrols">$$('.mod-harbour-boats').each(function(list){
    list.getElements('a').addEvent('click', function(event){
        new Event(event).stop();

        list.getElements('li.active').removeClass('active');
        this.getParent().addClass('active');

        var overlay = $('boat-overlay');
        //KOverlay reads the href value when making the request
        overlay.setProperty('href', this.getProperty('href'));
        //Instantiate KOverlay with evalScripts false to prevent duplicated events
        new KOverlay(overlay, "{evalScripts: false}");
    });
});</pre>


<p>The javascript is super simple. We get the <code>&lt;div id=”boat-overlay”&gt;</code> from our first layout, since this is were we want the ajax to be outputted. Then we give the overlay the same href value as the link we just clicked.</p>

<div id="”boat-overlay”">
  <p>
    And finally we initialize KOverlay, passing it our overlay div and letting KOverlay do all the work. That’s a wrap! At this point we got a fully working Split View powered by ajax.
  </p>
  
  <h3>
    Step 3 &#8211; Reusing the Split View elsewhere
  </h3>
  
  <p>
    How do I render this from another view or from a module? Thanks to Nooku strict naming conventions and out of the box HMVC, we can guess our way to it easily.
  </p>
  
  <p>
    We know that the view is <strong>“boats”</strong> and the layout is <strong>“split”</strong>. The controller action that’s called when you go to <strong>&view=boats</strong> is called “<strong>browse”</strong> since you’re browsing a list of items.
  </p>
  
  <p>
    So by that we can assume that we only have to use the factory to get the <strong>“boat”</strong> controller, override its default layout to <strong>“split”</strong> and execute <strong>“browse”</strong>.
  </p>
  
  <p>
    All that is done with just a few words:
  </p>
  
  <pre name="code" class="php:nocontrols">echo KFactory::tmp('site::com.harbour.controller.boat')
-&gt;layout('split')
-&gt;browse();</pre>
  
  <p>
    You can see it in use in the current mod_harbour module in the Harbour trunk:<br /> <a href="http://www.assembla.com/code/nooku-examples/subversion/nodes/trunk/harbour/code/site/modules/mod_harbour">/trunk/harbour/code/site/modules/mod_harbour</a>
  </p>
  
  <p>
    If you’ve heard about HMVC before but still not quite sure what it is, then I can tell you that what you’re looking at is one practical example of how HMVC works.<br /> Not only does it help reduce the amount of code, but more importantly it makes all your code predictable for yourself as much as others.
  </p>
  
  <h3>
    Conclusion
  </h3>
  
  <p>
    Split Views is just one example on how strict conventions and design patterns really helps you focus on what matters the most when creating great software that people enjoy using.
  </p>
  
  <p>
    Now, go have fun coding in the Disneyland of code already!
  </p>
</div>




  </article>

</div>

		<footer class="site-footer">

</footer>

	</body>
</html>
