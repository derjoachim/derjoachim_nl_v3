<!DOCTYPE html>
<html lang="en-US">
	<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,700italic,700,300' rel='stylesheet' type='text/css'>

	<title>Getting started with foreign keys</title>
	<meta name="description" content="      An often asked question on the Nooku Framework mailing list is how to deal with relations in databases. Nooku Framework doesn&#8217;t support relations...">

	<link rel="stylesheet" href="/css/main.css">
	<link rel="canonical" href="http://derjoachim.nl/blog/2012/01/getting-started-with-foreign-keys/">
	<link rel="alternate" type="application/rss+xml" title="Der Joachim" href="http://derjoachim.nl/feed.xml" />
	<script type="text/javascript">
		/*
		var _gaq = _gaq || [];
 	 	 _gaq.push(['_setAccount', 'UA-22946638-1']);
			_gaq.push(['_trackPageview']);

			(function() {
				var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
				ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
			})();
			*/
	</script>
</head>

	<body>
		<header class="site-header">
  <div class="wrapper">
    <a class="site-title" href="/">Der Joachim</a>
    <nav class="site-nav">
      <div class="trigger">
          
          <a class="page-link" href="/blog/2012/01/getting-started-with-foreign-keys/">Getting started with foreign keys</a>
          
      </div>
    </nav>
  </div>
</header>

		<div class="post">

  <header class="post-header">
    <h1 class="post-title">Getting started with foreign keys</h1>
    <p class="post-meta">Jan 31, 2012 • Gergo</p>
  </header>

  <article class="post-content">
    <p>  <p>
    An often asked question on the Nooku Framework mailing list is how to deal with relations in databases. Nooku Framework doesn&#8217;t support relations out of the box yet, but fortunately the InnoDB engine in MySQL does!
  </p></p>

<p>  <p>
    There are three important rules that must be met in order to create relations:
  </p></p>

<p>  <ol>
    <li>
      Both tables must be InnoDB tables and must not be TEMPORARY tables.
    </li>
    <li>
      Keys must have similar internal data types.
    </li>
    <li>
      Both foreign and referenced keys need to be indexed.
    </li>
  </ol></p>

<p>  <h3 dir="ltr">
    A basic example
  </h3></p>

<p>  <p>
    Let&#8217;s see the basics through an example:
  </p></p>

<p>  <p>
    Assume that we have an articles table with two columns: article_id and title. We have an authors table as well with the columns: author_id and name. Here is the SQL code for the tables:
  </p></p>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="o">`</span><span class="n">articles</span><span class="o">`</span> <span class="p">(</span>
<span class="o">`</span><span class="n">article_id</span><span class="o">`</span> <span class="nb">INT</span> <span class="n">UNSIGNED</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
<span class="o">`</span><span class="n">title</span><span class="o">`</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">article_id</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="nb">CHARACTER</span> <span class="k">SET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="o">`</span><span class="n">authors</span><span class="o">`</span> <span class="p">(</span>
<span class="o">`</span><span class="n">author_id</span><span class="o">`</span> <span class="nb">INT</span> <span class="n">UNSIGNED</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
<span class="o">`</span><span class="n">name</span><span class="o">`</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">author_id</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="nb">CHARACTER</span> <span class="k">SET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span></code></pre></div>


<p>  <p>
    We want to assign authors to articles. An author can belong to more than one articles, and an article can belong to more than one authors. So this is a many-to-many relation. That&#8217;s why we need a relation table too, which has article_id and author_id columns:
  </p></p>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="o">`</span><span class="n">articles_authors</span><span class="o">`</span> <span class="p">(</span>
<span class="o">`</span><span class="n">article_id</span><span class="o">`</span> <span class="nb">INT</span> <span class="n">UNSIGNED</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="o">`</span><span class="n">author_id</span><span class="o">`</span> <span class="nb">INT</span> <span class="n">UNSIGNED</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">article_id</span><span class="o">`</span><span class="p">)</span>
<span class="k">REFERENCES</span> <span class="o">`</span><span class="n">articles</span><span class="o">`</span><span class="p">(</span><span class="o">`</span><span class="n">article_id</span><span class="o">`</span><span class="p">)</span>
<span class="k">ON</span> <span class="k">DELETE</span> <span class="k">CASCADE</span><span class="p">,</span>
<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">author_id</span><span class="o">`</span><span class="p">)</span>
<span class="k">REFERENCES</span> <span class="o">`</span><span class="n">authors</span><span class="o">`</span><span class="p">(</span><span class="o">`</span><span class="n">author_id</span><span class="o">`</span><span class="p">)</span>
<span class="k">ON</span> <span class="k">DELETE</span> <span class="k">RESTRICT</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="nb">CHARACTER</span> <span class="k">SET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span></code></pre></div>


<p>  <p>
    As you can see, we specified the foreign keys with CASCADE and RESTRICT options. Let’s try to delete an article. Notice that relations in the articles_authors table are deleted with it automatically. Now let’s try to remove an author. If the author is referenced in the relation table, then MySQL refuses to delete it. This ensures referential integrity.
  </p></p>

<p>  <h3 dir="ltr">
    Keeping referential integrity
  </h3></p>

<p>  <p>
    By using InnoDB, you can prevent accidental removal of referenced rows. Other than its roboust data management features, it has usability advantages too. For example some of the database management tools support foreign keys too. For example in Sequel Pro, an arrow is displayed next to the column’s value, and it takes you to the referenced row when you click on it. This little feature can be useful many times.
  </p></p>

<p>  <div>
    <a title="foreignkeys by joomlatools, on Flickr" href="http://www.flickr.com/photos/joomlatools/6328763089/"><img src="http://farm7.static.flickr.com/6120/6328763089_2a1e7045a3_o.png" alt="foreignkeys" width="122" height="90" /></a>
  </div></p>

<p>  <p>
    InnoDB has become the default engine in MySQL 5.5 and has many features over MyISAM. I am highly recommending every developer to consider using it in their applications.
  </p></p>

<p>  <p>
    This was just a basic introduction to foreign keys, it is capable of much more! If you are interested, visit the <a href="http://dev.mysql.com/doc/refman/5.1/en/innodb-foreign-key-constraints.html">MySQL Reference Manual</a>.
  </p></p>

  </article>

</div>

		<footer class="site-footer">

</footer>

	</body>
</html>
